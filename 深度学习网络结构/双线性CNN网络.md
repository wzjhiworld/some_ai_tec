# 双线性CNN网络

## 双线性网络的诞生

在深度学习网络中，对于普通的分类问题，目前的网络已经达到超越人的水平，但是在很多的细粒度分类问题中，  
很多网络的精度还未达到惊艳的水准，后来就有人设计了双线性CNN网络，用来解决细粒度分类中的问题。在细粒  
分类问题中，主要的困难是：  

1. 用于区分不同的细粒度类别的特征一般只是图片中的部分区域，而非整体。 
  
网络结构:  

![](https://raw.githubusercontent.com/wzjhiworld/some_ai_tec/main/imgs/1618a6a754175bb0b5a581e3da3e8d90.png)

从网络结构上看最后特征层的外积形式之所以可以让网络有很大的性能提升，可能是因为形成的新的特征层很类似  
一种位置注意力，网络可以通过感知每个位置的特征交叉来知道当前位置是否包含具有区分力的特征，这比原有的  
网络要好很多。如上图中所示，可能 CNN Stream A 分支学习的是位置的重要性， 而 CNN Stream B 分支  
学习的是特征强度，两个外积以后形成的特征自然的学习过滤不重要的位置。  

为了验证猜想，设计了一个更明显的位置注意力网络来做一下对比实验。网络结构如下图所示:  

![](https://raw.githubusercontent.com/wzjhiworld/some_ai_tec/main/imgs/2021-08-1518-18-46.png)

## 实验  

从网上下载了一个对于 CUB 鸟类数据集进行分类的代码，进行一个复现的实验.并对网络结构做一些修改做一些实验。  
代码下载地址：https://github.com/Ylexx/Bilinear_CNN  

通过原始代码和修改后的代码，分别包含三种结构的网络:  

1. 原始 vgg
2. 双线性 vgg  
3. 位置注意力 vgg 

**只训练最后一层**  

|网络|精度|
|---|----|
|原始vgg|70.38%|
|双线性vgg|76.63%|  
|位置注意力vgg|70.02%|

**最后一层训练好后全网finetune**  

|网络|精度|
|---|----|
|原始vgg|71.85%|
|双线性vgg|82.74%|  
|位置注意力vgg|76.65%|

## 分析  

从实验的结果来看，虽然采用位置注意力的方式的精度高于原始vgg，但是还是比双线性vgg差不少，说明双线性方式  
形成的二阶特征，还是有更多的提升效果，除了提供了一定的位置注意力的可能，还有可能因为形成了很多的二阶特征，  
帮助网络更容易学习到区分不同类型的细节。我举一个简单的样例说明。  

假设一个网络最后输出的通道数为 3， 代表学习到了三种不同的独立特征，假设是特征一，特征二， 特征三。 现在  
假设要分的类型有两种类别。如下表:  

|类别|特征一|特征二|特征三|  
|---|---|---|---|
|类别1|1|1|-1|  
|类别1|-1|1|1|  
|类别2|1|1|1|  
|类别2|1|-1|-1|
注：表中类别1存在两种不同的特征表现形式，但是属于同一类，这种情况也比较常见  

其中 -1 代表该类不存在该特征， 1 代表该类别存在该特征  
我们假设每个类别学习到对应的权重向量如下表所示,(大概率最优权重应该如下所示，只是举例说明，没有严格证明)：  

|类别|特征一|特征二|特征三|  
|---|---|---|---|
|w1|0|1|0|  
|w2|1|0|0|  

对于对于类别2的图特征（1， 1， 1）：  
类别1得分. （1，1，1）点乘 （0，1，0） = 1  
类别2得分. （1，1，1）点乘 （1，0，0） = 1    

会发现 类别2的图片（1，1，1）无法被区分出来，因为类别2的得分不是最高，严格区分会存在困难。加入交叉  
特征可以缓解该类问题。通过深入思考可以发现，交叉特征的意义便是在此，对于为何细粒度分类问题需要引入交  
叉特征也可以得到较好的解释，因为在细粒度分类问题中，不同的类别可能共同存在很多共性特征，而单凭一阶特  
征的线性权重组合是难以进行类别区分的。

## 总结

通过上述的实验和思考，可以带来以下结论，当我们遇到一些比较难的细粒度分类问题时，可以通过采用生成二阶  
三阶等高阶交叉特征来完成模型性能的提升。  
后续可以试试看将双线性网络和位置注意力网络叠加起来能不能得到更优的效果。
